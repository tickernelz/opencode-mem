<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>OpenCode Memory Explorer</title>
    <link rel="stylesheet" href="/styles.css" />
    <link rel="icon" type="image/x-icon" href="/favicon.ico" />
    <script src="https://unpkg.com/lucide@latest"></script>
    <script src="https://cdn.jsdelivr.net/npm/marked@17.0.1/lib/marked.umd.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/dompurify@3.2.2/dist/purify.min.js"></script>
  </head>
  <body>
    <div class="container">
      <header class="header">
        <div class="header-top">
          <h1 class="title">┌─ OPENCODE MEMORY EXPLORER ─┐</h1>
          <a
            href="https://github.com/tickernelz/opencode-mem"
            target="_blank"
            rel="noopener noreferrer"
            class="github-link"
            title="View on GitHub"
          >
            <i data-lucide="github" class="icon"></i>
          </a>
        </div>
        <div class="stats-bar">
          <span id="stats-total">Total: 0</span>
          <span id="refresh-indicator" class="hidden"
            ><i data-lucide="rotate-cw" class="icon icon-spin"></i
          ></span>
        </div>
      </header>

      <div class="scope-tabs">
        <button id="tab-project" class="tab-btn active">
          <i data-lucide="folder" class="icon"></i>
          PROJECT MEMORIES
        </button>
        <button id="tab-profile" class="tab-btn">
          <i data-lucide="user" class="icon"></i>
          USER PROFILE
        </button>
      </div>

      <div class="controls">
        <div class="filter-group">
          <label>Tag:</label>
          <select id="tag-filter">
            <option value="">All Tags</option>
          </select>
        </div>

        <div class="search-group">
          <input type="text" id="search-input" placeholder="Search memories..." />
          <button id="search-btn"><i data-lucide="search" class="icon"></i></button>
          <button id="clear-search-btn" class="hidden"><i data-lucide="x" class="icon"></i></button>
        </div>

        <div class="maintenance-actions">
          <button id="cleanup-btn" class="btn-maintenance">
            <i data-lucide="trash" class="icon"></i> Cleanup
          </button>
          <button id="deduplicate-btn" class="btn-maintenance">
            <i data-lucide="refresh-cw" class="icon"></i> Deduplicate
          </button>
        </div>

        <div class="bulk-actions hidden" id="bulk-actions">
          <span id="selected-count">0 selected</span>
          <button id="bulk-delete-btn">
            <i data-lucide="trash-2" class="icon"></i> Delete Selected
          </button>
          <button id="deselect-all-btn"><i data-lucide="x" class="icon"></i> Deselect All</button>
        </div>
      </div>

      <div class="migration-section hidden" id="migration-section">
        <div class="migration-warning">
          <i data-lucide="alert-triangle" class="icon"></i>
          <span id="migration-message">Model dimension mismatch detected!</span>
        </div>
        <div class="migration-info">
          <label>
            <input type="checkbox" id="migration-confirm-checkbox" />
            I understand this operation is irreversible and will affect all stored memories
          </label>
        </div>
        <div class="migration-actions">
          <button id="migration-fresh-btn" class="btn-migration" disabled>
            <i data-lucide="trash" class="icon"></i> Fresh Start (Delete All)
          </button>
          <button id="migration-reembed-btn" class="btn-migration" disabled>
            <i data-lucide="refresh-cw" class="icon"></i> Re-embed (Preserve Data)
          </button>
        </div>
      </div>

      <div class="memories-section" id="project-section">
        <div class="section-header">
          <h2 id="section-title">└─ PROJECT MEMORIES (0) ──</h2>
          <div class="pagination" id="pagination-top">
            <button id="prev-page-top" disabled>
              <i data-lucide="chevron-left" class="icon"></i>
            </button>
            <span id="page-info-top">Page 1 of 1</span>
            <button id="next-page-top" disabled>
              <i data-lucide="chevron-right" class="icon"></i>
            </button>
          </div>
        </div>

        <div id="memories-list" class="memories-list">
          <div class="loading">Initializing...</div>
        </div>

        <div class="pagination" id="pagination-bottom">
          <button id="prev-page-bottom" disabled>
            <i data-lucide="chevron-left" class="icon"></i>
          </button>
          <span id="page-info-bottom">Page 1 of 1</span>
          <button id="next-page-bottom" disabled>
            <i data-lucide="chevron-right" class="icon"></i>
          </button>
        </div>
      </div>

      <div class="profile-section hidden" id="profile-section">
        <div class="section-header">
          <h2>└─ USER PROFILE ──</h2>
          <button id="refresh-profile-btn" class="btn-secondary">
            <i data-lucide="refresh-cw" class="icon"></i> Refresh
          </button>
        </div>

        <div id="profile-content" class="profile-content">
          <div class="loading">Loading profile...</div>
        </div>
      </div>

      <div class="add-section">
        <h2>└─ ADD NEW MEMORY ──</h2>
        <form id="add-form">
          <div class="form-row">
            <div class="form-group">
              <label>Tag:</label>
              <select id="add-tag" required>
                <option value="">Select tag</option>
              </select>
            </div>

            <div class="form-group">
              <label>Type:</label>
              <select id="add-type">
                <option value="">other</option>
                <option value="feature">feature</option>
                <option value="bug-fix">bug-fix</option>
                <option value="refactor">refactor</option>
                <option value="architecture">architecture</option>
                <option value="rule">rule</option>
                <option value="documentation">documentation</option>
                <option value="discussion">discussion</option>
                <option value="analysis">analysis</option>
                <option value="configuration">configuration</option>
              </select>
            </div>

            <div class="form-group">
              <label>Tags:</label>
              <input type="text" id="add-tags" placeholder="react, hooks, auth (comma separated)" />
            </div>
          </div>

          <div class="form-group">
            <label>Content:</label>
            <textarea
              id="add-content"
              rows="4"
              placeholder="Enter memory content..."
              required
            ></textarea>
          </div>

          <button type="submit" class="btn-primary">
            <i data-lucide="plus" class="icon"></i> Add Memory
          </button>
        </form>
      </div>
    </div>

    <div id="edit-modal" class="modal hidden">
      <div class="modal-content">
        <div class="modal-header">
          <h3>Edit Memory</h3>
          <button class="modal-close" id="modal-close"><i data-lucide="x" class="icon"></i></button>
        </div>
        <form id="edit-form">
          <input type="hidden" id="edit-id" />
          <div class="form-group">
            <label>Content:</label>
            <textarea id="edit-content" rows="6" required></textarea>
          </div>
          <div class="modal-actions">
            <button type="button" class="btn-secondary" id="cancel-edit">
              <i data-lucide="x" class="icon"></i> Cancel
            </button>
            <button type="submit" class="btn-primary">
              <i data-lucide="check" class="icon"></i> Save Changes
            </button>
          </div>
        </form>
      </div>
    </div>

    <div id="toast" class="toast hidden"></div>

    <div id="tag-migration-overlay" class="modal hidden">
      <div class="modal-content">
        <div class="modal-header">
          <h3>Memory Tagging Migration</h3>
        </div>
        <div class="migration-progress-body">
          <p id="tag-migration-status">Initializing migration...</p>
          <div class="progress-bar-container">
            <div id="tag-migration-progress" class="progress-bar" style="width: 0%"></div>
          </div>
          <p class="migration-note">
            Please don't close the browser. This will re-vectorize your memories with technical tags
            to improve search accuracy.
          </p>
        </div>
        <div class="modal-actions" id="tag-migration-actions">
          <button id="start-tag-migration-btn" class="btn-primary">
            <i data-lucide="play" class="icon"></i> Start Migration
          </button>
        </div>
      </div>
    </div>

    <div id="changelog-modal" class="modal hidden">
      <div class="modal-content">
        <div class="modal-header">
          <h3>Profile Version History</h3>
          <button class="modal-close" id="changelog-close">
            <i data-lucide="x" class="icon"></i>
          </button>
        </div>
        <div id="changelog-list" class="changelog-list">
          <div class="loading">Loading changelog...</div>
        </div>
      </div>
    </div>

    <script src="/app.js"></script>
  </body>
</html>
